!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Drawflow=e():t.Drawflow=e()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function o(t){return t.slice(5)}function n(t){return{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}}function i(t,e,o){if(void 0===o&&(o=[]),null!==e)for(var n in e)if(Object.hasOwnProperty.call(e,n)){var s=e[n];if("object"==typeof s&&null!==s)i(s,[n]);else for(var r=o.concat(n).join("-"),a=0,d=t.querySelectorAll("[df-"+r+"]");a<d.length;a++){var c=d[a];c.value=s,c.isContentEditable&&(c.innerText=s)}}}function s(t,e,o,n,i){var s={},r={on:function(t,e){return"function"!=typeof e?(console.error("The listener callback must be a function, the given type is ".concat(typeof e)),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is ".concat(typeof t)),!1):(void 0===s[t]&&(s[t]={listeners:[]}),void s[t].listeners.push(e))},removeListener:function(t,e){if(!s[t])return!1;var o=s[t].listeners,n=o.indexOf(e);n>-1&&o.splice(n,1)},dispatch:function(t,e){if(void 0===s[t])return!1;s[t].listeners.forEach((function(t){t(e)}))}},a=!1,d={nodeMoved:function(t){var e=t.id,o=t.x,i=t.y;e===n&&r.dispatch("moved",{x:o,y:i})},nodeSelected:function(t){t===n&&(r.dispatch("selected"),a=!0)},nodeUnselected:function(){a&&r.dispatch("unselected")},nodeUpdated:function(t){var e=t.id,o=t.data;e===n&&r.dispatch("updated",o)},nodeUpdateId:function(t){var e=t.oldId,o=t.newId;e===n&&(n=o,r.dispatch("updatedId",o))},nodeRemoved:function(e){if(e===n){for(var o in d){var i=d[o];t.removeListener(o,i)}r.dispatch("removed")}},connectionStart:function(t){t.output_id===n&&r.dispatch("connectionStart",t)},connectionCreated:function(t){t.output_id!==n&&t.input_id!==n||r.dispatch("connectionCreated",t)},connectionRemoved:function(t){t.output_id!==n&&t.input_id!==n||r.dispatch("connectionRemoved",t)}};for(var c in d){var l=d[c];t.on(c,l)}e({register:t.noderegister[o],type:o,content:i,editor:t,event:r})}t.d(e,{default:()=>r});const r=function(){function t(t,e){var o,n,i,s,r,a,d,c,l,u,h,p,_,f,v,m,w;void 0===e&&(e={}),this.container=t,this.events={},this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.first_click=null,this.noderegister={},this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=2,this.zoom_min=.1,this.zoom_value=.2,this.zoom_last_value=1,this.curvature=.5,this.reroute=!1,this.reroute_fix_curvature=!1,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.evCache=[],this.prevDiff=-1,this.module=null!==(o=e.module)&&void 0!==o?o:this.module,this.editor_mode=null!==(n=e.editor_mode)&&void 0!==n?n:this.editor_mode,this.zoom=null!==(i=e.zoom)&&void 0!==i?i:this.zoom,this.zoom_max=null!==(s=e.zoom_max)&&void 0!==s?s:this.zoom_max,this.zoom_min=null!==(r=e.zoom_min)&&void 0!==r?r:this.zoom_min,this.zoom_value=null!==(a=e.zoom_value)&&void 0!==a?a:this.zoom_value,this.zoom_last_value=null!==(d=e.zoom_last_value)&&void 0!==d?d:this.zoom_last_value,this.curvature=null!==(c=e.curvature)&&void 0!==c?c:this.curvature,this.reroute=null!==(l=e.reroute)&&void 0!==l?l:this.reroute,this.reroute_fix_curvature=null!==(u=e.reroute_fix_curvature)&&void 0!==u?u:this.reroute_fix_curvature,this.reroute_curvature_start_end=null!==(h=e.reroute_curvature_start_end)&&void 0!==h?h:this.reroute_curvature_start_end,this.reroute_curvature=null!==(p=e.reroute_curvature)&&void 0!==p?p:this.reroute_curvature,this.reroute_width=null!==(_=e.reroute_width)&&void 0!==_?_:this.reroute_width,this.force_first_input=null!==(f=e.force_first_input)&&void 0!==f?f:this.force_first_input,this.draggable_inputs=null!==(v=e.draggable_inputs)&&void 0!==v?v:this.draggable_inputs,this.useuuid=null!==(m=e.useuuid)&&void 0!==m?m:this.useuuid,this.render=null!==(w=e.render)&&void 0!==w?w:this.render}return Object.defineProperty(t.prototype,"zoomLevel",{get:function(){return Math.log2(this.zoom)},set:function(t){this.zoom=Math.pow(2,t),this.refreshZoom()},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this._dragEnd.bind(this)),this.container.addEventListener("mousemove",this._position.bind(this)),this.container.addEventListener("mousedown",this._click.bind(this)),this.container.addEventListener("touchend",this._dragEnd.bind(this)),this.container.addEventListener("touchmove",this._position.bind(this)),this.container.addEventListener("touchstart",this._click.bind(this)),this.container.addEventListener("contextmenu",this._contextmenu.bind(this)),this.container.addEventListener("keydown",this._key.bind(this)),this.container.addEventListener("wheel",this._handleZoom.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this._dblclick.bind(this)),this.container.onpointerdown=this._handlePointerdown.bind(this),this.container.onpointermove=this._handlePointermove.bind(this),this.container.onpointerup=this._handlePointerup.bind(this),this.container.onpointercancel=this._handlePointerup.bind(this),this.container.onpointerout=this._handlePointerup.bind(this),this.container.onpointerleave=this._handlePointerup.bind(this),this.load()},t.prototype._handlePointerdown=function(t){this.evCache.push(t)},t.prototype._handlePointermove=function(t){for(var e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(2==this.evCache.length){var o=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(o>this.prevDiff&&this.zoomIn(),o<this.prevDiff&&this.zoomOut()),this.prevDiff=o}},t.prototype._handlePointerup=function(t){this._removeEvent(t),this.evCache.length<2&&(this.prevDiff=-1)},t.prototype._removeEvent=function(t){for(var e=this.evCache.length-1;e>=0;e--)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}},t.prototype.load=function(){for(var t in this.drawflow.drawflow[this.module].data)this._addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this._addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateNodeConnections("node-"+t);var e=this.drawflow.drawflow,o=1;for(var n in e)if(Object.hasOwnProperty.call(e,n)){var i=e[n].data;for(var s in i)Object.hasOwnProperty.call(i,s)&&(o=Math.max(o,parseInt(s)+1))}this.nodeId=o},t.prototype.unselectConnectionReroutes=function(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((function(t){t.classList.remove("selected")}))},t.prototype._click=function(t){var e=this;function i(){null!=e.node_selected&&(e.node_selected.classList.remove("selected"),e.node_selected!=e.ele_selected&&e.dispatch("nodeUnselected",!0)),null!=e.connection_selected&&(e.connection_selected.classList.remove("selected"),e.unselectConnectionReroutes(),e.connection_selected=null)}this.dispatch("click",t);var s=t.target;if(t instanceof MouseEvent&&1===t.button)this.editor_selected=!0;else if(t instanceof MouseEvent&&0===t.button){if("fixed"===this.editor_mode){if("parent-drawflow"!==s.classList[0]&&"drawflow"!==s.classList[0])return!1;this.ele_selected=s.closest(".parent-drawflow")}else"view"===this.editor_mode?(null!=s.closest(".drawflow")||s.matches(".parent-drawflow"))&&(this.ele_selected=s.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=s,this.ele_selected=s,0===t.button&&this._contextmenuDel(),null!=s.closest(".drawflow_content_node")&&(this.ele_selected=s.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":i(),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",o(this.ele_selected.id)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?"SELECT"!==s.tagName&&(this.drag=!0):"INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName&&"SELECT"!==s.tagName&&!0!==s.hasAttribute("contenteditable")&&(this.drag=!0);break;case"output":this.connection=!0,i(),this._createConnection(s);break;case"drawflow":i(),this.editor_selected="touchstart"===t.type;break;case"main-path":i(),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected"),this.dispatch("connectionSelected",n(this.connection_selected.parentElement.classList)),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((function(t){t.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeSelectedConnection(),i()}this.ele_selected.classList.contains("parent-drawflow")&&(i(),this.editor_selected="touchstart"===t.type)}t instanceof TouchEvent?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),this.dispatch("clickEnd",t)},t.prototype._position=function(t){if(t instanceof TouchEvent)var e=t.touches[0].clientX,i=t.touches[0].clientY;else e=t.clientX,i=t.clientY;if(this.connection&&this._drawConnectionTo(e,i),this.editor_selected){var s=this.canvas_x-this.pos_x+e,r=this.canvas_y-this.pos_y+i;this.dispatch("translate",{x:s,y:r}),this.precanvas.style.transform="translate("+s+"px, "+r+"px) scale("+this.zoom+")"}if(this.drag){var a=this.drawflow.drawflow[this.module].data,d=o(this.ele_selected.id),c=(this.pos_x-e)/this.zoom,l=(this.pos_y-i)/this.zoom;this.pos_x=e,this.pos_y=i,a[d].pos_x-=c,a[d].pos_y-=l,this.ele_selected.style.left=a[d].pos_x+"px",this.ele_selected.style.top=a[d].pos_y+"px",this.updateNodeConnections(this.ele_selected.id)}if(this.drag_point){a=this.drawflow.drawflow[this.module].data,this.pos_x=e,this.pos_y=i;var u=(this.pos_x-this.precanvas.getBoundingClientRect().x)/this.zoom,h=(this.pos_y-this.precanvas.getBoundingClientRect().y)/this.zoom;this.ele_selected.setAttributeNS(null,"cx",u.toString()),this.ele_selected.setAttributeNS(null,"cy",h.toString());var p=n(this.ele_selected.parentElement.classList),_=p.output_id,f=p.input_id,v=p.output_class,m=p.input_class,w=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(w-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1)<0&&(w=0);var y=a[_].outputs[v].connections.findIndex((function(t){return t.node===f&&t.output===m}));a[_].outputs[v].connections[y].points[w]={pos_x:u,pos_y:h},this.updateNodeConnections("node-".concat(_))}"touchmove"===t.type&&(this.mouse_x=e,this.mouse_y=i),this.dispatch("mouseMove",{x:e,y:i})},t.prototype._dragEnd=function(t){var e,i,s;if(t instanceof TouchEvent?(e=this.mouse_x,i=this.mouse_y,s=document.elementFromPoint(e,i)):(e=t.clientX,i=t.clientY,s=t.target),this.drag&&(this.pos_x_start!=e||this.pos_y_start!=i)){var r=o(this.ele_selected.id),a=this.getNodeFromId(r);this.dispatch("nodeMoved",{id:r,x:a.pos_x,y:a.pos_y})}if(this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("rerouteMoved",n(this.ele_selected.parentElement.classList).output_id)),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-e),this.canvas_y=this.canvas_y+-(this.pos_y-i),this.editor_selected=!1),!0===this.connection)if("input"===s.classList[0]||this.force_first_input&&(null!=s.closest(".drawflow_content_node")||"drawflow-node"===s.classList[0])){if(!this.force_first_input||null==s.closest(".drawflow_content_node")&&"drawflow-node"!==s.classList[0])d=s.parentElement.parentElement.id,c=s.classList[1];else{if(null!=s.closest(".drawflow_content_node"))var d=s.closest(".drawflow_content_node").parentElement.id;else d=s.id;if(0===Object.keys(this.getNodeFromId(o(d)).inputs).length)var c="";else c="input_1"}var l=this.ele_selected.parentElement.parentElement.id,u=this.ele_selected.classList[1];if(l!==d&&c){if(0===this.container.querySelectorAll(".connection.node_in_"+d+".node_out_"+l+"."+u+"."+c).length){this.connection_ele.classList.add("node_in_"+d),this.connection_ele.classList.add("node_out_"+l),this.connection_ele.classList.add(u),this.connection_ele.classList.add(c);var h=o(d),p=o(l);this.drawflow.drawflow[this.module].data[p].outputs[u].connections.push({node:h,output:c}),this.drawflow.drawflow[this.module].data[h].inputs[c].connections.push({node:p,input:u}),this.updateNodeConnections("node-"+p),this.updateNodeConnections("node-"+h),this.dispatch("connectionCreated",{output_id:p,input_id:h,output_class:u,input_class:c})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)},t.prototype._contextmenu=function(t){if(this.dispatch("contextmenu",t),t.preventDefault(),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var e=document.createElement("div");e.classList.add("drawflow-delete"),e.innerHTML="x",this.node_selected&&this.node_selected.appendChild(e),this.connection_selected&&(e.style.top=t.clientY*this.zoom-this.precanvas.getBoundingClientRect().y*this.zoom+"px",e.style.left=t.clientX*this.zoom-this.precanvas.getBoundingClientRect().x*this.zoom+"px",this.precanvas.appendChild(e))}},t.prototype._contextmenuDel=function(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()},t.prototype._key=function(t){if(this.dispatch("keydown",t),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;("Delete"===t.key||"Backspace"===t.key&&t.metaKey)&&(null!=this.node_selected&&"INPUT"!==this.first_click.tagName&&"TEXTAREA"!==this.first_click.tagName&&!0!==this.first_click.hasAttribute("contenteditable")&&this.removeNodeId(this.node_selected.id),null!=this.connection_selected&&this.removeSelectedConnection())},t.prototype._handleZoom=function(t){t.preventDefault(),t.ctrlKey?this.zoomLevel-=t.deltaY/100:(this.canvas_x-=t.deltaX,this.canvas_y-=t.deltaY,this.dispatch("translate",{x:this.canvas_x,y:this.canvas_y}),this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")")},t.prototype.refreshZoom=function(){this.zoom=Math.min(Math.max(this.zoom_min,this.zoom),this.zoom_max),this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"},t.prototype.zoomIn=function(t){void 0===t&&(t=this.zoom_value),this.zoomLevel+=t,console.log(t)},t.prototype.zoomOut=function(t){void 0===t&&(t=this.zoom_value),this.zoomLevel-=t},t.prototype.resetZoom=function(){1!=this.zoom&&(this.zoom=1,this.refreshZoom())},t.prototype.createCurvature=function(t,e,o,n,i){var s=t,r=e,a=o,d=n,c=Math.abs(a-s)*i;return"M"+[s,r].join()+"C"+[s+1*c,r,a-1*c,d,a,d].join()},t.prototype._createConnection=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=e;var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.classList.add("main-path"),n.setAttributeNS(null,"d",""),e.classList.add("connection"),e.appendChild(n),this.precanvas.appendChild(e);var i=o(t.parentElement.parentElement.id),s=t.classList[1];this.dispatch("connectionStart",{output_id:i,output_class:s})},t.prototype._drawConnectionTo=function(t,e){var o,n=this.precanvas,i=this.zoom,s=n.getBoundingClientRect(),r=this.connection_ele.children[0],a=[((o=this.ele_selected.getBoundingClientRect()).x-s.x+o.width/2)/i,(o.y-s.y+o.width/2)/i],d=a[0],c=a[1],l=(t-this.precanvas.getBoundingClientRect().x)/i,u=(e-this.precanvas.getBoundingClientRect().y)/i,h=this.curvature,p=this.createCurvature(d,c,l,u,h);r.setAttributeNS(null,"d",p)},t.prototype.addConnection=function(t,e,o,n){var i=this.getModuleFromNodeId(t);if(i===this.getModuleFromNodeId(e)){for(var s=!1,r=0,a=this.getNodeFromId(t).outputs[o].connections;r<a.length;r++){var d=a[r];d.node==e&&d.output==n&&(s=!0)}if(!s){var c=this.drawflow.drawflow[i].data;if(c[t].outputs[o].connections.push({node:e.toString(),output:n}),c[e].inputs[n].connections.push({node:t.toString(),input:o}),this.module===i){var l=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.classList.add("main-path"),u.setAttributeNS(null,"d",""),l.classList.add("connection"),l.classList.add("node_in_node-"+e),l.classList.add("node_out_node-"+t),l.classList.add(o),l.classList.add(n),l.appendChild(u),this.precanvas.appendChild(l),this.updateNodeConnections("node-"+t),this.updateNodeConnections("node-"+e)}this.dispatch("connectionCreated",{output_id:t,input_id:e,output_class:o,input_class:n})}}},t.prototype.updateConnection=function(t,e,o){var n=this.container,i=this.precanvas,s=this.curvature,r=this.createCurvature,a=this.reroute_curvature,d=this.reroute_curvature_start_end,c=this.reroute_fix_curvature,l=this.reroute_width,u=this.zoom;if(!e){var h=t.classList[2].replace("node_out_","");e=n.querySelector("#".concat(h))}if(!o){var p=t.classList[1].replace("node_in_","");o=n.querySelector("#".concat(p))}if(e&&o){var _,f=i.getBoundingClientRect(),v=q(e.querySelector("."+t.classList[3])),m=v[0],w=v[1],y=q(o.querySelector("."+t.classList[4])),g=y[0],x=y[1],C=t.querySelectorAll(".point");if(0===C.length){var L=r(m,w,g,x,s);t.children[0].setAttributeNS(null,"d",L)}else{for(var N="",E=[],b=m,S=w,I=d,z=0;z<C.length;z++){var O=(void 0,[((_=C[z].getBoundingClientRect()).x-f.x)/u+l,(_.y-f.y)/u+l]),A=O[0],M=O[1],k=r(b,S,A,M,I);N+=k,E.push(k),b=A,S=M,I=a}var R=r(b,S,g,x,I=d);N+=R,E.push(R),c?E.forEach((function(e,o){t.children[o].setAttributeNS(null,"d",e)})):t.children[0].setAttributeNS(null,"d",N)}}function q(t){var e=t.getBoundingClientRect();return[(e.x-f.x+e.width/2)/u,(e.y-f.y+e.width/2)/u]}},t.prototype.updateNodeConnections=function(t){for(var e="node_in_"+t,o="node_out_"+t,n=this.container,i=n.querySelector("#node-".concat(t)),s=0,r=n.querySelectorAll(".".concat(o));s<r.length;s++){var a=r[s];this.updateConnection(a,i,null)}for(var d=0,c=n.querySelectorAll(".".concat(e));d<c.length;d++)a=c[d],this.updateConnection(a,null,i)},t.prototype._dblclick=function(t){null!=this.connection_selected&&this.reroute&&this.createReroutePoint(this.connection_selected),"point"===t.target.classList[0]&&this.removeReroutePoint(t.target)},t.prototype.createReroutePoint=function(t){this.connection_selected.classList.remove("selected");var e=n(this.connection_selected.parentElement.classList),o=e.output_id,i=e.input_id,s=e.output_class,r=e.input_class;this.connection_selected=null;var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.classList.add("point");var d=(this.pos_x-this.precanvas.getBoundingClientRect().x)*this.zoom,c=(this.pos_y-this.precanvas.getBoundingClientRect().y)*this.zoom;a.setAttributeNS(null,"cx",d.toString()),a.setAttributeNS(null,"cy",c.toString()),a.setAttributeNS(null,"r",this.reroute_width.toString());var l=0;if(this.reroute_fix_curvature){var u=t.parentElement.querySelectorAll(".main-path").length,h=document.createElementNS("http://www.w3.org/2000/svg","path");if(h.classList.add("main-path"),h.setAttributeNS(null,"d",""),t.parentElement.insertBefore(h,t.parentElement.children[u]),1===u)t.parentElement.appendChild(a);else{var p=Array.from(t.parentElement.children).indexOf(t);l=p,t.parentElement.insertBefore(a,t.parentElement.children[p+u+1])}}else t.parentElement.appendChild(a);var _=this.drawflow.drawflow[this.module].data[o].outputs[s].connections.find((function(t){return t.node===i&&t.output===r}));void 0===_.points&&(_.points=[]),this.reroute_fix_curvature?(l>0?_.points.splice(l,0,{pos_x:d,pos_y:c}):_.points.push({pos_x:d,pos_y:c}),t.parentElement.querySelectorAll(".main-path.selected").forEach((function(t){return t.classList.remove("selected")}))):_.points.push({pos_x:d,pos_y:c}),this.dispatch("addReroute",o),this.updateConnection(t.parentElement)},t.prototype.removeReroutePoint=function(t){var e=n(t.parentElement.classList),o=e.output_id,i=e.input_id,s=e.output_class,r=e.input_class,a=Array.from(t.parentElement.children).indexOf(t)-1,d=this.drawflow.drawflow[this.module].data[o].outputs[s].connections.findIndex((function(t){return t.node===i&&t.output===r}));if(this.reroute_fix_curvature){var c=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[c-1].remove(),(a-=c)<0&&(a=0)}this.drawflow.drawflow[this.module].data[o].outputs[s].connections[d].points.splice(a,1),t.remove(),this.dispatch("removeReroute",o),this.updateNodeConnections("node-".concat(o))},t.prototype.registerNode=function(t,e){this.noderegister[t]=e},t.prototype.getNodeFromId=function(t){var e=this.getModuleFromNodeId(t);if(e)return JSON.parse(JSON.stringify(this.drawflow.drawflow[e].data[t]))},t.prototype.getNodesFromName=function(t){var e=[],o=this.drawflow.drawflow;return Object.keys(o).map((function(n,i){for(var s in o[n].data)o[n].data[s].name==t&&e.push(o[n].data[s].id)})),e},t.prototype.addNode=function(t,e,o,n,r,a,d,c,l){var u,h;void 0===l&&(l=!1),h=this.useuuid?this.getUuid():this.nodeId.toString();var p=document.createElement("div");p.classList.add("parent-node");var _=document.createElement("div");_.setAttribute("id","node-"+h),_.classList.add("drawflow-node"),a&&(u=_.classList).add.apply(u,a.split(" "));var f=document.createElement("div");f.classList.add("inputs");var v=document.createElement("div");v.classList.add("outputs");for(var m={},w=0;w<e;w++){var y=document.createElement("div");y.classList.add("input"),y.classList.add("input_"+(w+1)),m["input_"+(w+1)]={connections:[]},f.appendChild(y)}var g={};for(w=0;w<o;w++){var x=document.createElement("div");x.classList.add("output"),x.classList.add("output_"+(w+1)),g["output_"+(w+1)]={connections:[]},v.appendChild(x)}var C=document.createElement("div");C.classList.add("drawflow_content_node"),!1===l?C.innerHTML=c:!0===l?C.appendChild(this.noderegister[c].cloneNode(!0)):s(this,"function"==typeof l?l:this.render,c,h,C),i(C,d),_.style.top=r+"px",_.style.left=n+"px",_.appendChild(f),_.appendChild(C),_.appendChild(v),p.appendChild(_),this.precanvas.appendChild(p);var L={id:h,name:t,data:d,class:a,html:c,typenode:l,inputs:m,outputs:g,pos_x:n,pos_y:r};return this.drawflow.drawflow[this.module].data[h]=L,this.dispatch("nodeCreated",h),this.useuuid||this.nodeId++,h},t.prototype._addNodeImport=function(t,e){var o;t.id=t.id.toString();var n=document.createElement("div");n.classList.add("parent-node");var r=document.createElement("div");r.setAttribute("id","node-"+t.id),r.classList.add("drawflow-node"),t.class&&(o=r.classList).add.apply(o,t.class.split(" "));var a=document.createElement("div");a.classList.add("inputs");var d=document.createElement("div");for(var c in d.classList.add("outputs"),t.inputs)if(Object.hasOwnProperty.call(t.inputs,c)){var l=t.inputs[c].connections,u=document.createElement("div");for(var h in u.classList.add("input"),u.classList.add(c),a.appendChild(u),l)if(Object.hasOwnProperty.call(l,h)){var p=l[h];p.node=p.node.toString();var _=document.createElementNS("http://www.w3.org/2000/svg","svg"),f=document.createElementNS("http://www.w3.org/2000/svg","path");f.classList.add("main-path"),f.setAttributeNS(null,"d",""),_.classList.add("connection"),_.classList.add("node_in_node-"+t.id),_.classList.add("node_out_node-"+p.node),_.classList.add(p.input),_.classList.add(c),_.appendChild(f),e.appendChild(_)}}for(var v=0;v<Object.keys(t.outputs).length;v++){var m=document.createElement("div");m.classList.add("output"),m.classList.add("output_"+(v+1)),d.appendChild(m)}var w=document.createElement("div");w.classList.add("drawflow_content_node"),!1===t.typenode?w.innerHTML=t.html:!0===t.typenode?w.appendChild(this.noderegister[t.html].cloneNode(!0)):"function"==typeof t.typenode?s(this,t.typenode,t.html,t.id,w):s(this,this.render,t.html,t.id,w),i(w,t.data),r.style.top=t.pos_y+"px",r.style.left=t.pos_x+"px",r.appendChild(a),r.appendChild(w),r.appendChild(d),n.appendChild(r),this.precanvas.appendChild(n)},t.prototype._addRerouteImport=function(t){var e=this.reroute_width,o=this.reroute_fix_curvature,n=this.container;for(var i in t.outputs)if(Object.prototype.hasOwnProperty.call(t.outputs,i)){var s=t.outputs[i];for(var r in s.connections)if(Object.prototype.hasOwnProperty.call(s.connections,r)){var a=s.connections[r],d=a.points;if(Array.isArray(a.points)){var c=a.node,l=a.output,u=n.querySelector(".connection.node_in_node-"+c+".node_out_node-"+t.id+"."+s+"."+l);if(o)for(var h=0;h<d.length;h++){var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.classList.add("main-path"),p.setAttributeNS(null,"d",""),u.appendChild(p)}for(var _=0,f=a.points;_<f.length;_++){var v=f[_],m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.classList.add("point"),m.setAttributeNS(null,"cx",v.pos_x.toString()),m.setAttributeNS(null,"cy",v.pos_y.toString()),m.setAttributeNS(null,"r",e.toString()),u.appendChild(m)}}}}},t.prototype.changeNodeID=function(t,e){var o=this.getModuleFromNodeId(t);if(!o)return!1;var n=this.drawflow.drawflow[o].data,i=n[t];if(this.getNodeFromId(e)||t===e)return!1;delete n[t],n[e]=i,i.id=e;var s=this.precanvas.querySelector("#node-".concat(t));for(var r in s.id="node-".concat(e),i.inputs)for(var a=0,d=i.inputs[r].connections;a<d.length;a++){var c=d[a],l=this.getNodeFromId(c.node);for(var u in l.outputs)for(var h=0,p=l.outputs[u].connections;h<p.length;h++)(g=p[h]).node===t&&g.output===r&&(g.node=e)}for(var u in i.outputs)for(var _=0,f=i.outputs[u].connections;_<f.length;_++){var v=f[_],m=this.getNodeFromId(v.node);for(var r in m.inputs)for(var w=0,y=m.inputs[r].connections;w<y.length;w++){var g;(g=y[w]).node===t&&g.input===u&&(g.node=e)}}return this.precanvas.querySelectorAll(".node_in_node-".concat(t,",.node_out_node-").concat(e)).forEach((function(o){o.classList.replace(".node_in_node-".concat(t),".node_in_node-".concat(e)),o.classList.replace(".node_out_node-".concat(t),".node_out_node-".concat(e))})),this.dispatch("updateNodeId",{oldId:t,newId:i.id}),!0},t.prototype.updateNodeValue=function(t){for(var e=t.target,n=e.attributes,i=0;i<n.length;i++)if(n[i].nodeName.startsWith("df-")){for(var s=n[i].nodeName.slice(3).split("-"),r=this.drawflow.drawflow[this.module].data[o(e.closest(".drawflow_content_node").parentElement.id)].data,a=0;a<s.length-1;a+=1)null==r[s[a]]&&(r[s[a]]={}),r=r[s[a]];r[s[s.length-1]]=e.value,e.isContentEditable&&(r[s[s.length-1]]=e.innerText),this.dispatch("nodeDataChanged",o(e.closest(".drawflow_content_node").parentElement.id))}},t.prototype.updateNodeDataFromId=function(t,e){var o=this.getModuleFromNodeId(t);this.drawflow.drawflow[o].data[t].data=e,this.module===o&&i(this.container.querySelector("#node-"+t),e)},t.prototype.addNodeInput=function(t){var e=this.getModuleFromNodeId(t),o=this.getNodeFromId(t),n=Object.keys(o.inputs).length;if(this.module===e){var i=document.createElement("div");i.classList.add("input"),i.classList.add("input_"+(n+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(i),this.updateNodeConnections("node-"+t)}this.drawflow.drawflow[e].data[t].inputs["input_"+(n+1)]={connections:[]}},t.prototype.addNodeOutput=function(t){var e=this.getModuleFromNodeId(t),o=this.getNodeFromId(t),n=Object.keys(o.outputs).length;if(this.module===e){var i=document.createElement("div");i.classList.add("output"),i.classList.add("output_"+(n+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(i),this.updateNodeConnections("node-"+t)}this.drawflow.drawflow[e].data[t].outputs["output_"+(n+1)]={connections:[]}},t.prototype.removeNodeInput=function(t,e){var o=this.getModuleFromNodeId(t),n=this.drawflow.drawflow[o].data[t];this.module===o&&this.container.querySelector("#node-"+t+" .inputs .input."+e).remove();for(var i=0,s=n.inputs[e].connections;i<s.length;i++){var r=s[i];this.removeConnection(r.node,t,r.input,e)}for(var a=parseInt(e.slice("input_".length))-1,d=Object.keys(n.inputs).length,c=a;c<=d;c++){var l="input_"+(c+1),u="input_"+(c+2);n.inputs[l]=n.inputs[u];for(var h=0,p=n.inputs[l].connections;h<p.length;h++){var _=p[h],f=this.drawflow.drawflow[o].data[_.node];for(var v in f.outputs)if(Object.prototype.hasOwnProperty.call(f.outputs,v))for(var m=0,w=f.outputs[v].connections;m<w.length;m++){var y=w[m];y.node===t&&y.output===u&&(y.output=l,this.module===o&&this.container.querySelector(".connection.node_in_node-"+y.node+".node_out_node-"+_.node+"."+y.output+"."+_.input).classList.replace(u,l))}}this.module===o&&this.container.querySelector("#node-"+t+" .inputs .input"+u).classList.replace(u,l)}delete n.inputs["input_"+d],this.updateNodeConnections("node-"+t)},t.prototype.removeNodeOutput=function(t,e){var o=this.getModuleFromNodeId(t),n=this.drawflow.drawflow[o].data[t];this.module===o&&this.container.querySelector("#node-"+t+" .outputs .output."+e).remove();for(var i=0,s=n.outputs[e].connections;i<s.length;i++){var r=s[i];this.removeConnection(r.node,t,r.output,e)}for(var a=parseInt(e.slice("output_".length))-1,d=Object.keys(n.outputs).length,c=a;c<=d;c++){var l="output_"+(c+1),u="output_"+(c+2);n.outputs[l]=n.outputs[u];for(var h=0,p=n.outputs[l].connections;h<p.length;h++){var _=p[h],f=this.drawflow.drawflow[o].data[_.node];for(var v in f.inputs)if(Object.prototype.hasOwnProperty.call(f.inputs,v))for(var m=0,w=f.inputs[v].connections;m<w.length;m++){var y=w[m];y.node===t&&y.input===u&&(y.input=l,this.module===o&&this.container.querySelector(".connection.node_in_node-"+y.node+".node_out_node-"+_.node+"."+y.input+"."+_.output).classList.replace(u,l))}}this.module===o&&this.container.querySelector("#node-"+t+" .outputs .output"+u).classList.replace(u,l)}delete n.outputs["output_"+d],this.updateNodeConnections("node-"+t)},t.prototype.removeNodeId=function(t){this.removeNodeConnectionsByNodeId(t);var e=this.getModuleFromNodeId(o(t));this.module===e&&this.container.querySelector("#".concat(t)).remove(),delete this.drawflow.drawflow[e].data[o(t)],this.dispatch("nodeRemoved",o(t))},t.prototype.removeSelectedConnection=function(){if(null!=this.connection_selected){var t=this.connection_selected.parentElement,e=n(t.classList),o=e.output_id,i=e.input_id,s=e.output_class,r=e.input_class;t.remove();var a=this.drawflow.drawflow[this.module].data,d=a[o].outputs[s].connections.findIndex((function(t){return t.node===i&&t.output===r}));a[o].outputs[s].connections.splice(d,1);var c=a[i].inputs[r].connections.findIndex((function(t){return t.node===o&&t.input===s}));a[i].inputs[r].connections.splice(c,1),this.dispatch("connectionRemoved",{output_id:o,input_id:i,output_class:s,input_class:r}),this.connection_selected=null}},t.prototype.removeConnection=function(t,e,o,n){var i=this.getModuleFromNodeId(t);if(i===this.getModuleFromNodeId(e)){if(this.drawflow.drawflow[i].data[t].outputs[o].connections.findIndex((function(t){return t.node==e&&t.output===n}))>-1){this.module===i&&this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t+"."+o+"."+n).remove();var s=this.drawflow.drawflow[i].data[t].outputs[o].connections.findIndex((function(t){return t.node==e&&t.output===n}));this.drawflow.drawflow[i].data[t].outputs[o].connections.splice(s,1);var r=this.drawflow.drawflow[i].data[e].inputs[n].connections.findIndex((function(e){return e.node==t&&e.input===o}));return this.drawflow.drawflow[i].data[e].inputs[n].connections.splice(r,1),this.dispatch("connectionRemoved",{output_id:t,input_id:e,output_class:o,input_class:n}),!0}return!1}return!1},t.prototype.removeNodeConnectionsByNodeId=function(t){for(var e="node_in_"+t,o="node_out_"+t,i=this.drawflow.drawflow[this.module].data,s=this.container.querySelectorAll(".".concat(o)),r=function(){var t=n(s[d].classList),e=t.output_id,o=t.input_id,r=t.output_class,c=t.input_class,l=i[o].inputs[c].connections.findIndex((function(t){return t.node===e&&t.input===r}));i[o].inputs[c].connections.splice(l,1);var u=i[e].outputs[r].connections.findIndex((function(t){return t.node===o&&t.output===c}));i[e].outputs[r].connections.splice(u,1),s[d].remove(),a.dispatch("connectionRemoved",{output_id:e,input_id:o,output_class:r,input_class:c})},a=this,d=s.length-1;d>=0;d--)r();var c,l,u=this.container.querySelectorAll(".".concat(e)),h=function(){var t=n(u[d].classList),e=t.output_id,o=t.input_id,s=t.output_class,r=t.input_class;c=i[e].outputs[s].connections.findIndex((function(t){return t.node===o&&t.output===r})),i[e].outputs[s].connections.splice(c,1),l=i[o].inputs[r].connections.findIndex((function(t){return t.node===e&&t.input===s})),i[o].inputs[r].connections.splice(l,1),u[d].remove(),p.dispatch("connectionRemoved",{output_id:e,input_id:o,output_class:s,input_class:r})},p=this;for(d=u.length-1;d>=0;d--)h()},t.prototype.getModuleFromNodeId=function(t){var e=this.drawflow.drawflow;for(var o in e)if(Object.hasOwnProperty.call(e,o)){var n=e[o].data;for(var i in n)if(Object.hasOwnProperty.call(n,i)&&i===t.toString())return o}},t.prototype.addModule=function(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)},t.prototype.changeModule=function(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)},t.prototype.removeModule=function(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)},t.prototype.clearSelectedModule=function(){for(;this.precanvas.hasChildNodes();)this.precanvas.firstChild.remove();this.drawflow.drawflow[this.module]={data:{}}},t.prototype.clear=function(){for(;this.precanvas.hasChildNodes();)this.precanvas.firstChild.remove();this.drawflow={drawflow:{Home:{data:{}}}}},t.prototype.export=function(){var t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t},t.prototype.import=function(t,e){void 0===e&&(e=!0),this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),e&&this.dispatch("import","import")},t.prototype.on=function(t,e){return"function"!=typeof e?(console.error("The listener callback must be a function, the given type is ".concat(typeof e)),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is ".concat(typeof t)),!1):(void 0===this.events[t]&&(this.events[t]={listeners:[]}),this.events[t].listeners.push(e),!0)},t.prototype.removeListener=function(t,e){if(!this.events[t])return!1;var o=this.events[t].listeners,n=o.indexOf(e),i=n>-1;return i&&o.splice(n,1),i},t.prototype.dispatch=function(t,e){if(void 0===this.events[t])return!1;for(var o=0,n=this.events[t].listeners.slice();o<n.length;o++)(0,n[o])(e);return!0},t.prototype.getUuid=function(){for(var t=[],e="0123456789abcdef",o=0;o<36;o++)t[o]=e.charAt(Math.floor(16*Math.random()));return t[14]="4",t[19]=e.charAt(3&parseInt(t[19],16)|8),t[8]=t[13]=t[18]=t[23]="-",t.join("")},t}();return e.default})()));
//# sourceMappingURL=drawflow.min.js.map